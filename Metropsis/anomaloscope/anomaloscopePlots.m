function anomaloscopePlots(varargin)
% Plots protanope and deuteranope anomaloscope matches
%
% Syntax:
%    anomaloscopePlots
%
% Description:
%    This routine plots Rayleigh matches made by protanopes and
%    deuteranopes who were tested on an Oculus-HMC anomaloscope (data
%    obtained by dce, summer 2019). The routine produces and saves four
%    plots: one of protanopes' matches, one of deuteranopes' matches, one
%    comparing the matches of protanopes and of deuteranopes with two
%    L-cone variants, and one plotting a least-squares line of best fit for 
%    each subject. To avoid overwriting files, it is advidable to change 
%    default PDF filenames. Data points were obtained from PDF reports of
%    anomaloscope results using a pixel color algorithm on
%    WebPlotDigitizer, a free online program. 
%
% Inputs
%    none
%
% Outputs
%    none. Saves plots as PDF files in an experimental directory
%
% Optional key-value pairs
%    'pittDiagram'    -logical indicating whether to plot results on the
%                      background of an anomaloscope Pitt diagram. Default
%                      is true.

% History:
%    07/25/19  dce       Wrote routine

% Examples:
%{
    anomaloscopePlots('pittDiagram', false)
%}

%% Parse input
p = inputParser;
p.addParameter('pittDiagram', true, @(x) (islogical(x)));
p.parse(varargin{:});

%% If applicable, load Pitt diagram image to use as plotting background
close all; 
if p.Results.pittDiagram
    pittDiagram = imread('/Users/deena/Dropbox (Aguirre-Brainard Lab)/MELA_materials/projectDichromat/pittDiagram.jpg');
end

%% Make/choose directory for saving plots
baseDir = '/Users/deena/Dropbox (Aguirre-Brainard Lab)/MELA_analysis/projectDichromat/anomaloscope plots';

% Make folder for Pitt diagram/no Pitt diagram
if p.Results.pittDiagram
    directory = fullfile(baseDir, 'pittBackground');
else
    directory = fullfile(baseDir, 'noBackground');
end
if (~exist(directory, 'dir'))
    mkdir(directory);
end

%% Axis limits for plots. The anomaloscope uses a mixing light ratio from 0
%%  (green) to 73 (red) and a reference light intensity from 0 to 45.
xMin = 0;
xMax = 73;
yMin = 0;
yMax = 45;
xVals = xMin:xMax; %vector with range of possible x values 

%% Deuteranopes
% Data
MELA_3003_X = [2.7435936060166
    3.51652969136103
    64.8192310175296
    65.585831561191
    0.364013796715724
    72.7859663080637
    0.3044100580034550
    0.304410058003469
    71.6236027852337
    72.4598942874098
    0.304410058003469
    72.725987038102];
MELA_3003_Y = [14.6014346014346
    14.6014346014346
    14.6014346014346
    14.6014346014346
    14.6016613323498
    14.6931031915813
    15.990712942854000
    14.6014346014346
    14.6014346014346
    14.6014346014346
    14.6014346014346
    14.6014346014346];

MELA_3004_X = [20.0090930347354
    20.7766101166507
    72.6725728092281
    0.42781847347409
    72.7456038970913
    0.0240562851001442
    72.604453040741
    0.165660528277769
    72.5776470375208
    0.289808007066597
    72.6725728092281
    0.289808007066611
    39.964537164532
    41.0862928996389
    42.2670884102777
    43.3888441453847
    44.5696396560235
    45.7504351666623
    46.8131511262373
    47.9939466368762
    49.174742147515
    50.3555376581539
    51.4182536177288
    52.4809695773038
    53.7798446390065
    54.8425605985815
    56.0233561092204
    57.1451118443273
    58.2668675794342
    59.447663090073
    60.5694188251799
    61.6911745602868
    62.8719700709257
    63.9346860305007
    65.2335610922034
    66.2962770517783
    67.4180327868853
    68.6578680730561
    69.720584032631
    70.9013795432699
    71.786976176249
    72.5544932581643
    0.644046660258255
    1.11636486451378
    2.17908082408876
    3.47795588579149
    4.54067184536646
    5.66242758047336
    6.90226286664416
    7.96497882621912
    9.14577433685797
    10.2084902964329
    11.3892858070718
    12.5700813177106
    13.6327972772856
    14.8726325634564
    15.9943882985633
    17.0571042581383
    18.2969395443091
    19.418695279416
    20.4814112389909
    21.6622067496298
    22.7839624847367
    24.0237977709075
    25.0865137304825
    26.2673092411213
    27.4481047517602
    28.5108207113351
    29.691616221974
    30.8724117326128
    31.9351276921878
    33.1159232028267
    34.2967187134655
    35.4775142241043
    36.5402301836793
    37.6619859187862
    38.901821204957
    39.964537164532
    72.6725728092281
    0.289808007066597
    72.6725728092281];
MELA_3004_Y = [14.6366998031023
    14.6366998031023
    14.6366998031023
    16.712269178834
    8.78478499642307
    14.927724151179
    8.96172501560774
    15.1459924122365
    11.5809441482975
    15.1456745496586
    11.761621961214
    15.571461076936
    15.353742609987
    13.1039851181803
    11.8702471388025
    11.1445189156391
    10.9948374696116
    11.1445189156391
    12.0153927834352
    11.6525286718535
    11.1445189156391
    11.1445189156391
    10.9993732710064
    10.4187906924757
    10.9948374696116
    10.1284994032103
    11.1445189156391
    11.1445189156391
    10.2781808492377
    9.76563529162858
    10.4187906924757
    9.76563529162858
    9.76563529162858
    9.03990706846515
    9.7610994902338
    10.1284994032103
    10.273645047843
    9.7610994902338
    8.49561090109259
    10.1284994032103
    9.33019835773052
    9.40277118004687
    15.8735532824281
    17.1104067617538
    16.3828458915622
    15.6598322768093
    16.0190654564664
    15.5097728473323
    15.2960518417135
    15.8735532824281
    15.1459924122365
    15.2960518417135
    15.1459924122365
    15.1459924122365
    14.927724151179
    14.2729193680065
    14.054651106949
    14.054651106949
    14.6366998031023
    14.6366998031023
    14.6366998031023
    14.4184315420448
    13.3958043189422
    13.7636267588724
    13.8727608894011
    12.6677381981463
    13.7636267588724
    14.4184315420448
    12.3130522739279
    12.8177976276233
    12.8177976276233
    13.1815780627191
    12.1629928444508
    11.9447245833934
    13.1815780627191
    11.9447245833934
    10.5259808865197
    13.1815780627191
    10.1985784949335
    13.8727608894011
    9.68928588579935];

MELA_3009_X = [7.96497882621912
    44.3334805538957
    0.139669603992431
    71.6592013245127
    0.146665929052332
    64.9427589595733
    65.6379007930439
    3.81464836949269
    4.64290246894697
    47.7712766476731
    48.5403697400235
    4.54067184536646
    37.6619859187862];
MELA_3009_Y = [14.656399410173
    14.7482390610005
    18.1653700235317
    8.23416414541612
    16.079788546118
    10.7637548013614
    10.7655057883475
    14.7104545083187
    14.7125407906851
    14.8211764939061
    14.8231137561034
    14.6366998031023
    14.6366998031023];

MELA_3011_X = [0.289808007066597
    40.982973292458
    41.6766906549583
    0.168593130389397
    72.5907177829056
    0.411221359870609
    50.1954816031738
    50.9482231603657
    0.289808007066597
    72.6725728092281
    0.409780956272357
    72.7704803877806
    0.289808007066597
    72.6725728092281
    0.289808007066597
    72.6725728092281
    0.289808007066597
    39.964537164532
    41.0862928996389
    42.2670884102777
    43.3888441453846
    44.5696396560235
    45.7504351666623
    46.8131511262373
    47.9939466368762
    49.174742147515
    50.3555376581538
    51.4182536177288
    52.4809695773038
    53.7798446390065
    54.8425605985815
    56.0233561092203
    57.1451118443273
    58.2668675794341
    59.447663090073
    60.5694188251799
    61.6911745602868
    62.8719700709257
    63.9346860305006
    65.2335610922034
    66.2962770517783
    67.4180327868852
    68.6578680730561
    69.720584032631
    70.9308994310358
    72.0231352783768
    72.6725728092281];
MELA_3011_Y = [14.6366998031023
    14.6366998031023
    14.6366998031023
    14.6366998031023
    9.83479805983767
    14.6362859750092
    14.5105681461119
    14.5086672835938
    14.6362230092355
    12.9069241294501
    14.6366998031023
    11.9447245833934
    14.6363819405245
    10.8885489169841
    14.6366998031023
    10.3440906689718
    14.6376386294159
    14.519559078352
    14.3768796208165
    14.3798614276616
    14.3826941441644
    13.9900647278427
    13.9884992792491
    13.8820487748809
    13.8850305817259
    12.6511589092452
    12.6541407160903
    12.0747756460975
    11.4226544890856
    11.4213872211765
    11.4286181027757
    11.4315999096207
    10.4886034948744
    10.4914362113772
    10.4944180182223
    10.4972507347251
    10.2090591031512
    10.2120409099963
    10.2101772807181
    9.63595582753307
    9.63863945369361
    9.64147217019641
    9.35357871930707
    9.35626234546761
    10.2187499753976
    10.3200320145678
    10.5278142548868];

MELA_3012_X = [2.30761126034233
    59.2923387224412
    0.974920028506631
    64.9825788682009
    65.6379007930439
    1.68030126705283
    2.33562319189578
    57.9469698695399
    58.5385799405787
    0.289808007066597
    69.3663453794394
    10.0905623896053
    14.6899042472745
    19.7773577821563
    24.3706988777584
    29.8148436734011
    39.8257174893916
    49.8533263499047];
MELA_3012_Y = [15.5045701558541
    9.68569454143498
    11.9423145173641
    8.85444518568171
    8.79602459411244
    16.5325616669349
    16.3284956484207
    9.54300700704016
    8.26828151937897
    15.1459924122365
    8.23416414541612
    14.2480627595353
    13.5452654332126
    14.7692718076523
    13.334381509139
    14.8576060070257
    11.6992670253792
    10.5826034754946];

MELA_3016_X = [9.61809254111353
    10.5036891740926
    35.1991838537395
    35.9498324283599
    0.120679730881278
    72.6075190784642
    1.70676261983321
    2.17908082408876
    72.6725728092281
    9.02081699463383
    72.6780606384052
    0.289808007066597
    39.964537164532
    41.0862928996389
    42.2670884102777
    43.3888441453846
    44.5696396560235
    45.7504351666623
    46.8131511262373
    47.9939466368762
    49.174742147515
    50.3555376581538
    51.4182536177288
    52.4809695773038
    53.7798446390065
    54.8425605985815
    56.0233561092203
    57.1451118443273
    58.2668675794341
    59.447663090073
    60.5694188251799
    61.8092541113507
    62.517731417734
    0.289808007066597
    72.6725728092281
    3.60929697359398
    5.26237341590281
    8.68668039675549
    10.3398313842354
    12.1109873776082
    17.1884080733552
    22.4429480956981
    24.1551015861244
    31.003864638172
    35.1262516489209
    36.026143205906
    36.8915913440608
    39.0908229826256
    39.7845403451259
    41.2014949578926
    44.7461614103026
    45.4789217255037
    45.8294692632523
    46.7727401397651
    49.498670684922
    35.6917536015897
    45.2670144063587
    45.0211127670144
    0.289808007066597
    44.4431258513122
    45.100997635811
    0.289808007066597
    71.7279364007171
    72.3183341560365];
MELA_3016_Y = [14.6128256664486
    14.6105893113148
    14.5482269510127
    14.546331373804
    20.4564643744943
    7.7593698330885
    12.8139015968314
    11.5758553947676
    7.54176891410269
    14.8413180083112
    2.08786317767205
    14.418113679467
    10.2435840964003
    11.1744544966434
    11.1835987043016
    11.1898604986762
    12.4146376602795
    11.3521453362179
    10.226289616699
    9.35023476562407
    11.166155134258
    9.55799215755276
    10.069148395965
    9.70268433470868
    9.69940434717913
    9.04191593784614
    10.3849217408556
    8.81783315344082
    9.53801405169094
    10.5581647185528
    9.9005272188776
    8.69919451359348
    8.65875375825752
    14.2729193680065
    8.59794458051192
    16.0236127119051
    16.0190654564664
    16.0190654564664
    16.0236127119051
    16.0190654564664
    16.0190654564664
    16.0190654564664
    16.0190654564664
    16.0372544782212
    14.7687867467978
    14.1118166038927
    14.054651106949
    14.054651106949
    14.054651106949
    14.054651106949
    13.0231918408154
    12.4934267396629
    11.6065741334975
    11.2762780339048
    10.7078711040676
    14.3939393939394
    12.5757575757576
    12.5757575757576
    14.6366998031023
    14.6366998031023
    14.6366998031023
    14.927724151179
    8.81621284156941
    7.724871536282];

MELA_3019_X = [0.289808007066597
    60.2742199475202
    0.644046660258255
    1.11636486451378
    65.9420383985867
    66.5324361539061
    0.146665929052332
    72.6780606384052
    0.224156099458128
    49.9574142873226
    4.18960735240542
    10.0027797728189
    14.2293735605936
    19.6821755277143
    24.2777671472367
    29.7218670399852
    34.5651876694248
    40.0078309917848
    49.8127158878413
    55.4949837130852
    65.2885521776621];
MELA_3019_Y = [17.2922969793017
    8.96172501560774
    17.4026435144619
    16.0214705838358
    9.12783133877026
    8.40630862743986
    16.3825273762891
    7.39588075932068
    16.0190654564664
    10.7078711040676
    16.7266017688979
    18.6007876943333
    14.5831930833257
    15.7993920097457
    13.4901677246287
    13.6468890962351
    12.6872613089496
    12.6666452357588
    10.7378472577453
    11.0801039510788
    7.7735304404106];

% Create figure and add image background if applicable
figure(1);
if p.Results.pittDiagram
    imagesc([xMin xMax], [yMin yMax], flipud(pittDiagram));
    hold on;
    set(gca, 'ydir', 'normal');
end

% Plot data
plot(MELA_3003_X, MELA_3003_Y, '.', MELA_3004_X, MELA_3004_Y, '.',...
    MELA_3009_X, MELA_3009_Y, '.', MELA_3011_X, MELA_3011_Y, '.',...
    MELA_3012_X, MELA_3012_Y, '.', MELA_3016_X, MELA_3016_Y, '.',...
    MELA_3019_X, MELA_3019_Y, '.', 'MarkerSize', 14);

% If not using image background, set axes and grid
if ~p.Results.pittDiagram
    axis([xMin xMax yMin yMax]);
    grid on;
end

title('Deuteranope Matches', 'FontSize', 16);
xlabel('Mixing Light', 'FontSize', 14);
ylabel('Reference Light', 'FontSize', 14);
legend('MELA\_3003', 'MELA\_3004', 'MELA\_3009', 'MELA\_3011',...
    'MELA\_3012', 'MELA\_3016', 'MELA\_3019');

% Save PDF
print('-bestfit', fullfile(directory, 'deuteranopes'), '-dpdf');
hold off;

%% Protanopes
% Data
MELA_3006_X = [38.57741736591840
    34.8521188562256
    35.7390946918668
    0.304410058003469
    70.6415938243454
    0.161003494336811
    69.4430327763661
    70.0651933985267];
MELA_3006_Y = [14.710514710514700
    14.7105147105147
    14.7105147105147
    26.1639261639262
    2.65716265716266
    19.6463896463897
    3.5050125959217
    2.46627246627247];

MELA_3007_X = [11.3472592117356
    70.6766060283838
    71.3955232846403
    22.7892474915062
    68.3354566516784
    68.9119909448451
    41.0014043347377
    72.7315960649294
    41.0609497057136
    72.725987038102
    41.0609497057136
    71.7503136188968];
MELA_3007_Y = [21.2007812007812
    2.02859650228072
    1.97541197541199
    21.9370719370719
    3.50253350253351
    2.65716265716266
    10.9770000679092
    1.23912123912125
    14.2250969150353
    1.43730199171678
    13.0743130743131
    1.97541197541199];

% Create figure and add image background if applicable
figure(2);
if p.Results.pittDiagram
    imagesc([xMin xMax],[yMin yMax],flipud(pittDiagram));
    hold on;
    set(gca, 'ydir', 'normal');
end

% Plot data
plot(MELA_3006_X, MELA_3006_Y, '.', MELA_3007_X, MELA_3007_Y, '.', 'MarkerSize', 14);

% If not using image background, set axes and grid
if ~p.Results.pittDiagram
    axis([xMin xMax yMin yMax]);
    grid on;
end

title('Protanope Matches', 'FontSize', 16);
xlabel('Mixing Light', 'FontSize', 14);
ylabel('Reference Light', 'FontSize', 14);
legend('MELA\_3006', 'MELA\_3007');

% Save PDF
print('-bestfit', fullfile(directory, 'protanopes'), '-dpdf');
hold off;

%% Comparison
% Data
deuteranopesLong_X = MELA_3003_X;
deuteranopesLong_Y = MELA_3003_Y;
deuteranopesShort_X = [MELA_3004_X; MELA_3009_X; MELA_3011_X; MELA_3012_X; MELA_3016_X; MELA_3019_X];
deuteranopesShort_Y = [MELA_3004_Y; MELA_3009_Y; MELA_3011_Y; MELA_3012_Y; MELA_3016_Y; MELA_3019_Y];
protanopes_X = [MELA_3006_X; MELA_3007_X];
protanopes_Y = [MELA_3006_Y; MELA_3007_Y];

% Calculate lines of best fit for each subject group using least squares
% method. polyfit() returns a slope and intercept for each group
dLongFit = polyfit(deuteranopesLong_X, deuteranopesLong_Y, 1);
dShortFit = polyfit(deuteranopesShort_X, deuteranopesShort_Y, 1);
pFit = polyfit(protanopes_X, protanopes_Y, 1);

% Calculate y values of groups' fit lines from formula parameters
dLongFitY = (xVals * dLongFit(1)) + dLongFit(2);
dShortFitY = (xVals * dShortFit(1)) + dShortFit(2);
pFitY = (xVals * pFit(1)) + pFit(2);

% Create figure and add image background if applicable
figure(3);
if p.Results.pittDiagram
    imagesc([xMin xMax], [yMin yMax], flipud(pittDiagram));
    hold on; 
    set(gca, 'ydir', 'normal');
else 
    hold on; 
end

% Plot data and best-fit lines
plot(deuteranopesLong_X, deuteranopesLong_Y, 'y.', deuteranopesShort_X,...
    deuteranopesShort_Y, 'b.', protanopes_X, protanopes_Y, 'c.', 'MarkerSize', 14);
plot(xVals, dLongFitY, 'y', xVals, dShortFitY, 'b', xVals, pFitY, 'c', 'LineWidth', 2.5);

% If not using image background, set axes and grid
if ~p.Results.pittDiagram
    axis([xMin xMax yMin yMax]);
    grid on;
end

title('Comparison of Deuteranope and Protanope Matches', 'FontSize', 16);
xlabel('Mixing Light', 'FontSize', 14);
ylabel('Reference Light', 'FontSize', 14);
legend('Deuteranopes Long', 'Deuteranopes Short', 'Protanopes');

% Save PDF
print('-bestfit', fullfile(directory, 'comparison'), '-dpdf');
hold off

%% Plot with lines of best fit for each subject 
% Calculate lines of best fit for each subject using least squares method. 
% polyfit() returns a slope and intercept for each subject
MELA_3003Fit = polyfit(MELA_3003_X, MELA_3003_Y, 1);
MELA_3004Fit = polyfit(MELA_3004_X, MELA_3004_Y, 1);
MELA_3006Fit = polyfit(MELA_3006_X, MELA_3006_Y, 1);
MELA_3007Fit = polyfit(MELA_3007_X, MELA_3007_Y, 1);
MELA_3009Fit = polyfit(MELA_3009_X, MELA_3009_Y, 1);
MELA_3011Fit = polyfit(MELA_3011_X, MELA_3011_Y, 1);
MELA_3012Fit = polyfit(MELA_3012_X, MELA_3012_Y, 1);
MELA_3016Fit = polyfit(MELA_3016_X, MELA_3016_Y, 1);
MELA_3019Fit = polyfit(MELA_3019_X, MELA_3019_Y, 1);

% Calculate y values of subjects' fit lines from formula parameters 
MELA_3003FitY = (xVals * MELA_3003Fit(1)) + MELA_3003Fit(2);
MELA_3004FitY = (xVals * MELA_3004Fit(1)) + MELA_3004Fit(2);
MELA_3006FitY = (xVals * MELA_3006Fit(1)) + MELA_3006Fit(2);
MELA_3007FitY = (xVals * MELA_3007Fit(1)) + MELA_3007Fit(2);
MELA_3009FitY = (xVals * MELA_3009Fit(1)) + MELA_3009Fit(2);
MELA_3011FitY = (xVals * MELA_3011Fit(1)) + MELA_3011Fit(2);
MELA_3012FitY = (xVals * MELA_3012Fit(1)) + MELA_3012Fit(2);
MELA_3016FitY = (xVals * MELA_3016Fit(1)) + MELA_3016Fit(2);
MELA_3019FitY = (xVals * MELA_3019Fit(1)) + MELA_3019Fit(2);

% Create figure and add image background if applicable
figure(4);
if p.Results.pittDiagram
    imagesc([xMin xMax], [yMin yMax], flipud(pittDiagram));
    hold on;
    set(gca, 'ydir', 'normal');
end

% Plot data
plot(xVals, MELA_3003FitY, 'y', xVals, MELA_3004FitY, 'm', xVals,...
    MELA_3006FitY, 'c', xVals, MELA_3007FitY, xVals, MELA_3009FitY,...
    xVals, MELA_3011FitY, xVals, MELA_3012FitY, xVals, MELA_3016FitY,...
     xVals, MELA_3019FitY, 'LineWidth', 2.5); 

% If not using image background, set axes and grid
if ~p.Results.pittDiagram
    axis([xMin xMax yMin yMax]);
    grid on;
end

title('Subject Lines of Best Fit', 'FontSize', 16);
xlabel('Mixing Light', 'FontSize', 14);
ylabel('Reference Light', 'FontSize', 14);
legend('MELA\_3003', 'MELA\_3004','MELA\_3006', 'MELA\_3007',...
    'MELA\_3009', 'MELA\_3011', 'MELA\_3012', 'MELA\_3016', 'MELA\_3019');

% Save PDF
print('-bestfit', fullfile(directory, 'subjectFits'), '-dpdf');
hold off;
end