function [W,b] = MakeRawWiener(B,f0,Kf,n0,Kn)% [W,b] = MakeRawWiener(B,f0,Kf,n0,Kn)%% Makes the Wiener estimator.  See Pratt pp. 410 ff.% This function follows Pratt's notation;% Don't confuse with interpolation notation (e.g. B% is not a linear model here!)%% Note that for the linear/Normal problem, this estimator% is equivalent to the Bayesian estimator.  The name goes% back to the time before I understood this.%% 7/18/94		dhb		Added this line.% 9/13/94		dhb		Changed sign of W*n0 in expression for b.%									Pratt's equation is in error.% Determin system size[m,n] = size(B);Bt = B';if ( m <= n)  % Underdetermined (or square) system  % Use equation 14.6-10 from Pratt  % W = Kf*B'*inv(B*Kf*B'+Kn)  Q1 = B*Kf;  Q2 = Q1*Bt;  clear Q1;  Q3 = Q2+Kn;  clear Q2;  Q3inv = inv(Q3);  clear Q3;  Q4 = Bt*Q3inv;  clear Q3inv;  W = Kf*Q4;  clear Q4;else  % Overdetermined system  % This has probably never been executed/tested  % Use equation 14.6-11  % W =inv(B'*inv(Kn)*B+inv(Kf))*B'*inv(Kn)  Kninv = inv(Kn);  Kfinv = inv(Kf);  Q1 = Kninv*B;  Q2 = Bt*Q1;  clear Q1;	 Q3 = Q2+Kfinv;  clear Q2;  Q3inv = inv(Q3);  clear Q3;  Q4 = Q3inv*Bt;  clear Q3inv;  W = Q4*Kninv;  clear Q4;endclear Bt;% Compute bias term according to equation 14.6-9% Note difference in sign of W*n0 in equation below% and Pratt's equation.  Pratt's equation is in error;% he forgot to distribute the - sign when expanding.b = f0 - W*B*f0 - W*n0;